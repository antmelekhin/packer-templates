{
  "variables": {
    "headless": "true",
    "iso_url": "../_iso/debian-10.9.0-amd64-netinst.iso",
    "iso_checksum": "8660593d10de0ce7577c9de4dab886ff540bc9843659c8879d8eea0ab224c109",
    "vm_name": "debian-10",
    "cpus": "1",
    "memory": "512",
    "disk_size": "10000",
    "ssh_username": "vagrant",
    "ssh_password": "vagrant",
    "shutdown_command": "sudo shutdown -P now"
  },
  "builders": [
    {
      "type": "hyperv-iso",
      "headless": "{{ user `headless` }}",
      "iso_url": "{{ user `iso_url` }}",
      "iso_checksum": "sha256:{{ user `iso_checksum` }}",
      "http_directory": "./",
      "boot_wait": "5s",
      "boot_command": [
        "<esc><wait>",
        "auto ",
        "net.ifnames=0 ",
        "preseed/url=http://{{ .HTTPIP }}:{{ .HTTPPort }}/answer_files/10/preseed.cfg ",
        "netcfg/get_hostname={{ user `vm_name` }} <wait>",
        "passwd/root-login=false ",
        "passwd/make-user=true ",
        "passwd/user-fullname=\"{{ user `ssh_username` }}\" ",
        "passwd/username=\"{{ user `ssh_username` }}\" ",
        "passwd/user-password=\"{{ user `ssh_password` }}\" ",
        "passwd/user-password-again=\"{{ user `ssh_password` }}\" ",
        "preseed/late_command=\"wget http://{{ .HTTPIP }}:{{ .HTTPPort }}/scripts/debian-postinstall.sh && /bin/sh debian-postinstall.sh {{ user `ssh_username` }}\" ",
        "<enter>"
      ],
      "vm_name": "{{ user `vm_name` }}",
      "cpus": "{{ user `cpus` }}",
      "memory": "{{ user `memory` }}",
      "disk_size": "{{ user `disk_size` }}",
      "switch_name": "Default Switch",
      "communicator": "ssh",
      "ssh_username": "{{ user `ssh_username` }}",
      "ssh_password": "{{ user `ssh_password` }}",
      "shutdown_command": "{{ user `shutdown_command` }}"
    }
  ],
  "post-processors": [
    {
      "type": "vagrant",
      "keep_input_artifact": false,
      "output": "./builds/{{ user `vm_name` }}_{{ .Provider }}.box"
    }
  ]
}